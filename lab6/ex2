Nested loop works slowly. So, I created several indexes for optimization.
